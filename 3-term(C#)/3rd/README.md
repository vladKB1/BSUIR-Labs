# **FileWatcherService**
**Parser** - универсальный расширяемый обработчик *(парсер)* **XML/JSON** файлов. Представляет из себя библиотеку классов.

**FileWatcherService** - windows-служба *(сервис)*. При запуске сервиса загружается конфигурационный файл при помощи менеджера опций - `OptionsManager`. Далее в соответствии с настройками выполняется работа windows-службы. *(описание её работы находится в предыдущей лабораторной)*

----
  1. Все конфигурационные свойства находятся в папке **Options** и логически разбиты на соответствующие классы:
		- `class  Options` - общий класс, от которого наследуются конкретные опции.
		- `class  WorkFoldersOptions : Options` - содержит опции `SourceDir` и `TargetDir`.
		- `class  LoggerOptions : Options` - содержит опцию `NeedToLog` и опцию `LogFile` - путь к файлу **log.txt**.
		- `class  EncryptionOptions : Options` - содержит опцию `NeedToEncrypt`.
		- `class  ArchivationOptions : Options` - содержит опцию `ArchiveDir` - путь к папке, где будут сохраняться архивы, и опцию `CompressionLevel` - степень/уровень сжатия файла.
2. Все видимые исключительные ситуации обработаны и залогированы с помощью класса `Logger`.
3. Обработчик **XML**-файлов реализован с помощью универсальной расширяемой библиотеки классов - `Parser`.  Обработка выполняется методом `T DeserializeXML<T>(string XML) where T : new()`.
4. Обработчик **JSON**-файлов реализован с помощью универсальной расширяемой библиотеки классов - `Parser`.  Обработка выполняется методом `T DeserializeJson<T>(string json) where T : new()`.
5. Содержимому конфигурационных файлов предоставлена соответствующая модель на стороне **.NET**, а именно классы `class ETLJsonOptions : ETLOptions` и `class ETLXmlOptions : ETLOptions`, наследуемые от класса `class ETLOptions : Options`.
6. Как уже писалось выше, для каждого логически отдельного блока конфигураций есть соответствующая модель на стороне **.NET**, а именно это классы:
	  - `WorkFoldersOptions`
	  - `LoggerOptions`
	  - `EncryptionOptions`
	  - `ArchivationOptions`
7. Реализован менеджер опций - `OptionsManager`. Этот класс загружает файлы конфигурации **appsettings.json** и **config.xml**. Если менеджер опций находит **JSON-конфигурацию**, то загружается она, иначе загружается **XML-конфигурация**. Если обе конфигурации отсутствуют или не прошли валидацию, то загружается стандартная конфигурация.
Менеджер опций реализован так, что есть возможность доставать конфигурацию не только целиком из всего файла, а ещё секциями.
 **Реализующий метод:** 
`Options  FindOption<T>(ETLOptions  options)`
8. Менеджер конфигурации получает на вход путь к файлу с использованием **AppDomain**:
 
```c#
    string appDirectory = AppDomain.CurrentDomain.BaseDirectory;
    optionsManager = new OptionsManager(appDirectory);
```
   
9. После обработки файлов конфигурации, проходит валидация настроек *(представлено классом `Validation`)* и windows-служба начинает свою работу.
10. Обработчик **XML/JSON** файлов универсальный и расширяемый.
11. Наименования свойств модели совпадают с наименованием тэгов/секций в **XML/JSON** файлах.